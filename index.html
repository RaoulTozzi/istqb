<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ISTQB Syllabus Trainer</title>
<style>
  :root{
    --bg:#f1d6be; --panel:#ffeede; --card:#f6e6d6; --ink:#2b3a3a; --muted:#6b7a7a; --accent:#3b6a64; --accent-2:#2e4e4a; --ok:#2f855a; --warn:#b7791f; --err:#c53030;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
  header{position:sticky;top:0;z-index:10;background:var(--panel);box-shadow:0 1px 0 rgba(0,0,0,.05)}
  .bar{max-width:1200px;margin:auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
  .brand{font-weight:800;letter-spacing:.3px}
  .spacer{flex:1}
  .btn{cursor:pointer;border:0;border-radius:12px;background:var(--accent);color:#fff;padding:10px 14px;font-weight:600}
  .btn.secondary{background:var(--accent-2)}
  .btn.flat{background:transparent;border:2px solid var(--accent);color:var(--accent)}
  .hint{color:var(--muted);font-size:12px}
  .layout{max-width:1200px;margin:14px auto;display:grid;grid-template-columns:280px 1fr;gap:16px;padding:0 16px}
  aside{background:var(--panel);border-radius:16px;padding:12px 10px;height:calc(100vh - 120px);position:sticky;top:86px;overflow:auto}
  .toc h3{margin:6px 10px 8px;font-size:14px;text-transform:uppercase;color:var(--muted)}
  .toc button{display:block;width:100%;text-align:left;background:transparent;border:0;border-radius:12px;padding:10px 12px;margin:4px 0;font-weight:600;color:var(--accent-2)}
  .toc button.active{background:var(--card);color:var(--ink)}
  main{min-height:60vh}
  .card{background:var(--panel);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.05);padding:18px}
  .reading{padding:4px 8px}
  .reading h2{margin:10px 0 6px}
  .reading p{margin:8px 0}
  .reading ul{margin:8px 0 8px 20px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
  .flash{display:grid;place-items:center;gap:12px;padding:10px}
  .flash .flip{width:min(700px,100%);min-height:170px;background:var(--card);border-radius:18px;display:flex;align-items:center;justify-content:center;padding:24px;text-align:center;cursor:pointer;box-shadow:0 8px 18px rgba(0,0,0,.08)}
  .flip.flipped{background:#fff}
  .flash .row{display:flex;gap:8px}
  .tag{display:inline-block;border-radius:999px;padding:2px 10px;font-size:12px;background:var(--card);color:var(--muted);margin-right:6px}
  .quiz .q{margin:10px 0;padding:14px;border-radius:14px;background:var(--panel);border:1px solid rgba(0,0,0,.06)}
  .opt{display:block;margin:6px 0;padding:10px;border-radius:10px;cursor:pointer;border:1px solid rgba(0,0,0,.08)}
  .opt input{margin-right:6px}
  .opt.correct{background:rgba(47,133,90,.10);border-color:var(--ok)}
  .opt.wrong{background:rgba(197,48,48,.10);border-color:var(--err)}
  .explain{font-size:13px;color:var(--muted)}
  .result{padding:10px;border-radius:12px;background:#fff;margin:12px 0;border-left:6px solid var(--accent)}
  .muted{color:var(--muted)}
  footer{padding:30px 16px;text-align:center;color:var(--muted)}
  @media (max-width: 880px){
    .layout{grid-template-columns:1fr}
    aside{position:static;height:auto}
  }
</style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand">ISTQB Syllabus Trainer</div>
      <div class="hint">Nauka rozdziałami → fiszki → mini‑testy → egzamin końcowy</div>
      <div class="spacer"></div>
      <a class="btn flat" href="egzamin_quiz_full40.html" title="40 pytań — pełny egzamin" style="text-decoration:none;display:inline-block;text-align:center">Egzamin 40Q</a>
      <button class="btn flat" id="resetBtn" title="Wyczyść postęp">Reset</button>
      <button class="btn" id="fullExamBtn">Egzamin końcowy</button>
    </div>
  </header>

  <div class="layout">
    <aside>
      <div class="toc" id="toc"></div>
      <div class="card" style="margin-top:12px">
        <div style="font-weight:700;margin-bottom:6px">Postęp</div>
        <div class="hint" id="progressHint">—</div>
      </div>
    </aside>

    <main>
      <div class="card reading" id="reading"></div>
      <div class="card" style="margin-top:12px">
        <div class="controls">
          <button class="btn" id="showFlash">Fiszki</button>
          <button class="btn secondary" id="showQuiz">Mini‑test</button>
          <button class="btn flat" id="nextChapter">Następny rozdział →</button>
        </div>
        <div id="after"></div>
      </div>
    </main>
  </div>

  <footer>Nieoficjalny trener do nauki zgodnie z sylabusem ISTQB FL 4.0.1. Zestaw pytań bazuje na przykładowym egzaminie CTFL (Sample Exam A) i został przypisany tematycznie do rozdziałów.
  </footer>

<script>
/** -------------------------------------------------------
 *  DANE – skróty treści, fiszki i pytania (PL)
 *  Wszystko w jednym pliku dla prostoty GitHub Pages.
 *  Możesz swobodnie rozszerzać.
 * ------------------------------------------------------*/
// Podgląd PDF sylabusa per rozdział
const PDF_URL = "assets/ISTQB_CertyfikowanyTester_PoziomPodstawowy_v4.0.1.pdf";
let __pdfDoc = null;
async function __ensurePdf(){
  if(!window.pdfjsLib) return null;
  if(!__pdfDoc){
    try{ __pdfDoc = await pdfjsLib.getDocument(PDF_URL).promise; }catch(e){ __pdfDoc=null; }
  }
  return __pdfDoc;
}
async function renderPdfPages(startPage, endPage){
  const host = $$("#reading");
  host.innerHTML = "";
  if(!window.pdfjsLib){
    host.innerHTML = `<div class="tag">Podgląd sylabusa</div><div class="hint">Ładowanie podglądu PDF…</div>`;
    setTimeout(()=>renderPdfPages(startPage, endPage), 400);
    return;
  }
  const doc = await __ensurePdf();
  if(!doc){
    host.innerHTML = `<div class="tag">Podgląd sylabusa</div><div class="hint">Ładowanie PDF…</div>`;
    setTimeout(()=>renderPdfPages(startPage, endPage), 500);
    return;
  }
  const tag = document.createElement("div");
  tag.className = "tag";
  tag.textContent = `Podgląd sylabusa (${startPage}–${endPage})`;
  host.appendChild(tag);
  for(let p=startPage; p<=endPage; p++){
    const page = await doc.getPage(p);
    const viewport = page.getViewport({ scale: 1.05 });
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = viewport.width; canvas.height = viewport.height;
    host.appendChild(canvas);
    await page.render({ canvasContext: ctx, viewport }).promise;
  }
}
// Zakresy stron PDF dla rozdziałów (przybliżone; możesz skorygować jeśli potrzebujesz)
const chapterToPdf = { r1:{from:17,to:36}, r2:{from:37,to:60}, r3:{from:61,to:70}, r4:{from:71,to:120}, r5:{from:121,to:170}, r6:{from:171,to:186} };
const syllabus = [
  {
    id:"r1",
    title:"1. Podstawy testowania",
    read:`<h2>1. Podstawy testowania</h2>
      <p>Testowanie to <b>zbiór czynności</b> służących do wykrywania defektów i oceny jakości produktów pracy. Obejmuje cały proces (planowanie→analiza→projektowanie→implementacja→wykonywanie→ukończenie), a nie tylko samo uruchamianie testów.</p>
      <ul>
        <li><b>Cele testów:</b> ocena produktów pracy, wykrywanie defektów/awarii, pokrycie, redukcja ryzyka, zgodność z wymaganiami/prawem, informowanie o jakości, budowanie zaufania.</li>
        <li><b>Testowanie vs. debugowanie:</b> testowanie ujawnia awarie/defekty; debugowanie <i>lokalizuje i usuwa</i> przyczynę, po czym wykonuje się testy potwierdzające i ewentualnie regresję.</li>
        <li><b>7 zasad:</b> testy ujawniają defekty (nie dowodzą ich braku), gruntowne testowanie jest niemożliwe, wczesne testowanie, kumulacja defektów, zużywanie się testów, zależność od kontekstu, złudzenie braku defektów.</li>
        <li><b>Testalia:</b> plan/harmonogram, rejestr ryzyk, warunki/przypadki/procedury, dane i środowisko testowe, dzienniki i raporty, raport sumaryczny.</li>
        <li><b>Śledzenie powiązań:</b> łączenie wymagań/ryzyk z testami, wynikami i defektami → ocena pokrycia i wpływu zmian.</li>
      </ul>`,
    flashcards:[
      {q:"Wymień 3–4 typowe cele testów.", a:"Ocena produktów pracy; wykrywanie defektów/awarii; zapewnienie pokrycia; redukcja ryzyka; potwierdzenie wymagań i zgodności; dostarczenie informacji do decyzji; budowanie zaufania."},
      {q:"Czym różni się testowanie od debugowania?", a:"Testowanie wykrywa awarie/defekty; debugowanie diagnozuje i usuwa defekt, po czym wykonuje się testy potwierdzające (i regresję)."},
      {q:"Podaj 3 z 7 zasad testowania.", a:"Np.: testy ujawniają defekty, a nie dowodzą ich braku; gruntowne testowanie jest niemożliwe; wczesne testowanie oszczędza czas/koszt; defekty się kumulują; testy się zużywają; testowanie zależy od kontekstu; złudzenie braku defektów."},
      {q:"Po co śledzić powiązania?", a:"Aby mierzyć pokrycie, oceniać ryzyko rezydualne, analizować wpływ zmian i przygotować audytowalne raporty."},
    ],
    quiz:[
      {q:"Które stwierdzenie najlepiej opisuje weryfikację i walidację?", opt:["Walidacja sprawdza zgodność ze specyfikacją; weryfikacja – z potrzebami","Weryfikacja sprawdza zgodność ze specyfikacją, walidacja – czy spełnia potrzeby","To to samo","Żadne"], a:1, exp:"Weryfikacja = spełnienie specyfikacji, walidacja = spełnienie potrzeb interesariuszy."},
      {q:"Która z zasad NIE należy do 7 zasad testowania?", opt:["Testy zależą od kontekstu","Gruntowne testowanie jest możliwe","Testy się zużywają","Defekty często się kumulują"], a:1, exp:"Gruntowne testowanie jest niemożliwe – to właściwa zasada."},
      {q:"Co następuje bezpośrednio po debugowaniu?", opt:["Testowanie potwierdzające","Testowanie wydajności","Inspekcja","Analiza ryzyka"], a:0, exp:"Po usunięciu defektu sprawdzamy poprawkę testem potwierdzającym."},
      {q:"Który produkt pracy NIE jest typowym testalium?", opt:["Plan testów","Dane testowe","Repozytorium kodu produkcyjnego","Raport sumaryczny"], a:2, exp:"Repozytorium kodu to nie testalium – choć może być elementem kontekstu."},
      {q:"Po co utrzymywać śledzenie powiązań wymagań→testy?", opt:["Dla estetyki","Aby ocenić pokrycie i wpływ zmian","Aby przyspieszyć kompilację","To obowiązkowe tylko w Scrum"], a:1}
    ]
  },
  {
    id:"r2",
    title:"2. Testowanie w cyklu wytwarzania",
    read:`<h2>2. Testowanie w cyklu wytwarzania</h2>
      <p>Model SDLC wpływa na <b>czas/cel testów, techniki i automatyzację</b>. W zwinnych podejściach iteracyjnie dostarczamy przyrosty i szeroko stosujemy automatyczną regresję.</p>
      <ul>
        <li><b>Poziomy testów:</b> modułowe → integracja modułów → systemowe → integracja systemów → akceptacyjne.</li>
        <li><b>Typy testów:</b> funkcjonalne, niefunkcjonalne, czarnoskrzynkowe, białoskrzynkowe. Potwierdzające vs. regresji.</li>
        <li><b>„Najpierw test”:</b> TDD/ATDD/BDD. <b>Shift‑left</b> = wcześniejsze przeglądy, analizy i testy.</li>
        <li><b>DevOps:</b> CI/CD, szybka informacja zwrotna, stabilne środowiska i szeroka automatyzacja – przy wciąż potrzebnym teście manualnym z perspektywy użytkownika.</li>
      </ul>`,
    flashcards:[
      {q:"Wymień 5 poziomów testów z sylabusa.", a:"Modułowe, integracja modułów, systemowe, integracja systemów, akceptacyjne."},
      {q:"Czym różni się test potwierdzający od regresji?", a:"Potwierdzający sprawdza, czy usunięty defekt zniknął; regresja – czy zmiany nie zepsuły obszarów niezmienianych (może być szeroka)."},
      {q:"Na czym polega shift‑left?", a:"Przesunięcie aktywności testowych wcześniej w SDLC: przeglądy, analiza statyczna, pisanie testów przed kodem, CI."},
      {q:"Wpływ DevOps na testowanie w 2 punktach.", a:"Szybka informacja zwrotna + automatyzacja (CI/CD), stabilniejsze środowiska; nadal potrzebne testy manualne użytkownika."}
    ],
    quiz:[
      {q:"Który poziom następuje bezpośrednio po testowaniu systemowym?", opt:["Modułowe","Integracja modułów","Integracja systemów","Akceptacyjne"], a:2},
      {q:"Które twierdzenie o DevOps jest prawdziwe?", opt:["Eliminuje testy manualne","Wymaga CI/CD i zwiększa automatyzację","Dotyczy tylko operacji","Nie łączy się z shift‑left"], a:1},
      {q:"Który zestaw to <i>typy</i> testów, a nie poziomy?", opt:["Funkcjonalne, niefunkcjonalne, białoskrzynkowe","Modułowe, integracja, systemowe","Modułowe, akceptacyjne, UAT","Integracja systemów, integracja modułów"], a:0},
      {q:"Najlepsza definicja shift‑left?", opt:["Przenosimy testy z UAT do produkcji","Wcześniejsze uruchamianie przeglądów i testów","Testujemy tylko manualnie","Zwiększamy liczbę testów E2E"], a:1},
      {q:"Testy potwierdzające …", opt:["to to samo co regresja","sprawdzają konkretną poprawkę","zawsze obejmują pełny system","są wyłącznie automatyczne"], a:1}
    ]
  },
  {
    id:"r3",
    title:"3. Testowanie statyczne",
    read:`<h2>3. Testowanie statyczne</h2>
      <p>Ocena kodu/specyfikacji <b>bez uruchamiania</b> (przeglądy, analiza statyczna). Pozwala wcześnie wykrywać niejednoznaczności, luki i błędy, obniżając koszty.</p>
      <ul>
        <li><b>Typy przeglądów:</b> nieformalny, przejrzenie (autor prowadzi), przegląd techniczny (moderator), inspekcja (najbardziej formalna, metryki).</li>
        <li><b>Role:</b> kierownik, autor, moderator, protokolant, przeglądający, lider przeglądu.</li>
        <li><b>Czynniki sukcesu:</b> jasne cele/kryteria, właściwy dobór typu, małe partie, czas na przygotowanie, kultura informacji zwrotnej.</li>
      </ul>`,
    flashcards:[
      {q:"Podaj 2 korzyści z testowania statycznego.", a:"Wczesne wykrycie defektów (tańsze poprawki), możliwość oceny niewykonywalnych artefaktów, poprawa komunikacji, metryki jakości."},
      {q:"Najbardziej formalny typ przeglądu?", a:"Inspekcja – pełny proces, zbiera metryki."},
      {q:"Rola moderatora?", a:"Zapewnia sprawny, bezpieczny przebieg spotkania, zarządza czasem i mediacją."}
    ],
    quiz:[
      {q:"Które stwierdzenie najlepiej odróżnia testowanie statyczne od dynamicznego?", opt:["Statyczne uruchamia kod","Statyczne nie uruchamia kodu i może badać wymagania","Dynamiczne służy tylko do przeglądów","Statyczne wykrywa tylko błędy kompilacji"], a:1},
      {q:"Który typ przeglądu zbiera metryki i ma najsurowszy proces?", opt:["Nieformalny","Przejrzenie","Przegląd techniczny","Inspekcja"], a:3},
      {q:"Kto NIE jest rolą w przeglądach wg sylabusa?", opt:["Moderator","Product Owner","Protokolant","Przeglądający"], a:1}
    ]
  },
  {
    id:"r4",
    title:"4. Analiza i projektowanie testów",
    read:`<h2>4. Analiza i projektowanie testów</h2>
      <ul>
        <li><b>Czarnoskrzynkowe:</b> klasy równoważności (ECP), wartości brzegowe (BVA 2‑ i 3‑punktowe), tablice decyzyjne, przejścia stanów (pokrycie stanów/przejść/wszystkich przejść).</li>
        <li><b>Białoskrzynkowe:</b> pokrycie instrukcji oraz gałęzi.</li>
        <li><b>Oparte na doświadczeniu:</b> zgadywanie błędów, eksploracyjne, listy kontrolne.</li>
        <li><b>Współpraca:</b> historyjki użytkownika (INVEST), kryteria akceptacji (Given/When/Then lub reguły), ATDD.</li>
      </ul>`,
    flashcards:[
      {q:"ECP – co jest elementem pokrycia?", a:"Klasa równoważności (poprawna/niepoprawna)."},
      {q:"BVA 3‑punktowa – jakie wartości wokół progu?", a:"Wartość brzegowa oraz obie wartości sąsiednie (np. 9,10,11 dla progu 10)."},
      {q:"State transition – minimalne kryterium dla krytycznych systemów?", a:"Pokrycie wszystkich przejść (poprawnych i próby niepoprawnych)."},
      {q:"Pokrycie gałęzi a instrukcji – relacja?", a:"100% gałęzi subsumuje 100% instrukcji."}
    ],
    quiz:[
      {q:"W ECP elementem pokrycia jest…", opt:["Wartość brzegowa","Klasa równoważności","Ścieżka w kodzie","Przejście stanu"], a:1},
      {q:"Próg 10 (≤10 dozwolone). Który zestaw najlepiej pokrywa BVA 3‑punktowe?", opt:["8,9,10","9,10,11","10,11,12","0,10,20"], a:1},
      {q:"Co zapewni 100% pokrycia stanów?", opt:["Odpalimy wszystkie poprawne i niepoprawne przejścia","Odwiedzimy każdy stan co najmniej raz","Odwiedzimy każdy stan dokładnie raz","Sprawdzimy wszystkie wejścia/wyjścia"], a:1},
      {q:"Które stwierdzenie o pokryciu jest prawdziwe?", opt:["100% instrukcji ⇒ 100% gałęzi","100% gałęzi ⇒ 100% instrukcji","Żadne nie zachodzi","Zawsze potrzeba 100% ścieżek"], a:1}
    ]
  },
  {
    id:"r5",
    title:"5. Zarządzanie czynnościami testowymi",
    read:`<h2>5. Zarządzanie testami</h2>
      <ul>
        <li><b>Plan testów:</b> kontekst/zakres, role, komunikacja, rejestr ryzyk, podejście (poziomy/typy/techniki/kryteria wejścia‑wyjścia/metryki), budżet i harmonogram.</li>
        <li><b>Kryteria wejścia/wyjścia:</b> gotowość zasobów i artefaktów vs. warunki zakończenia (np. poziom pokrycia, liczba otwartych defektów, wykonanie zakresu).</li>
        <li><b>Estymacje:</b> proporcje (historyczne), ekstrapolacja, szerokopasmowa delficka/poker, trójpunktowe.</li>
        <li><b>Priorytetyzacja:</b> wg ryzyka, pokrycia (dodatkowe), wymagań; uwzględnij zależności i dostępność zasobów.</li>
        <li><b>Piramida testów & kwadranty:</b> różna szczegółowość, automatyzacja nisko‑poziomowa vs. testy wysokopoziomowe; Q1–Q4 (cele biznes/tech × wsparcie/krytyka).</li>
        <li><b>Ryzyko:</b> prawdopodobieństwo × wpływ; produktowe vs. projektowe; testowanie oparte na ryzyku.</li>
      </ul>`,
    flashcards:[
      {q:"Wymień 3 elementy planu testów.", a:"Kontekst i zakres; role/odpowiedzialności; podejście i kryteria; rejestr ryzyk; budżet i harmonogram; komunikacja."},
      {q:"Czym jest Definition of Done / Ready?", a:"DoD – kryteria wyjścia dla elementu; DoR – kryteria wejścia, by rozpocząć pracę nad historyjką."},
      {q:"Podaj 2 techniki estymacji.", a:"Np. proporcje, ekstrapolacja, delficka/poker, trójpunktowa (E=(a+4m+b)/6)."},
      {q:"Ryzyka produktowe vs. projektowe – przykład.", a:"Produktowe: błędy jakości (np. bezpieczeństwo). Projektowe: opóźnienia, braki zasobów."}
    ],
    quiz:[
      {q:"Który element nie należy do typowej treści planu testów?", opt:["Rejestr ryzyk","Budżet","Szczegóły implementacji baz danych","Kryteria wejścia/wyjścia"], a:2},
      {q:"W technice trójpunktowej przy a=6, m=9, b=18 – E wynosi?", opt:["9","10","11","12"], a:1, exp:"E=(6+4*9+18)/6=10."},
      {q:"Która strategia priorytetyzacji wykonuje najpierw testy o największym wkładzie w pokrycie?", opt:["Wg wymagań","Wg ryzyka","Wg dodatkowego pokrycia","Losowa"], a:2},
      {q:"Które zdanie o ryzyku jest prawdziwe?", opt:["Poziom ryzyka to iloczyn prawdopodobieństwa i wpływu","Ryzyka dotyczą tylko projektu, nie produktu","Ocena ryzyka nie wpływa na testy","Ryzyka ustala wyłącznie kierownik projektu"], a:0}
    ]
  },
  {
    id:"r6",
    title:"6. Narzędzia testowe",
    read:`<h2>6. Narzędzia testowe</h2>
      <p>Klasy narzędzi (przykłady): zarządzanie testami i defektami, CI/CD, wirtualizacja usług, narzędzia do testów wydajności i bezpieczeństwa, narzędzia analizy statycznej, raportowanie.</p>
      <ul>
        <li><b>Korzyści:</b> szybkość, powtarzalność, ślad audytu, regresja 24/7, spójne środowiska.</li>
        <li><b>Ryzyka/wydatki:</b> koszty wdrożenia i utrzymania, krzywa uczenia, kruchość testów UI, złe dopasowanie do procesu.</li>
      </ul>`,
    flashcards:[
      {q:"Podaj 2 korzyści automatyzacji.", a:"Szybsza regresja i powtarzalność; spójne środowiska; ślad audytu."},
      {q:"Podaj jedno ryzyko automatyzacji.", a:"Koszty utrzymania, kruchość testów UI, nietrafiony dobór narzędzi."}
    ],
    quiz:[
      {q:"Które stwierdzenie o automatyzacji jest najbliższe prawdy?", opt:["Zawsze się opłaca","Zastępuje całkowicie testy manualne","Wymaga inwestycji i nie eliminuje testów manualnych","Dotyczy tylko testów UI"], a:2}
    ]
  }
];

/** -------------------------------------------------------
 *  PYTANIA EGZAMINACYJNE – CTFL Sample Exam A (40) z przypisaniem do rozdziałów
 *  Pola:
 *    id: numer pytania
 *    chapter: 'r1'..'r6' – przypisanie tematyczne do rozdziału
 *    q: treść pytania
 *    opt: tablica opcji
 *    a: indeks poprawnej odpowiedzi lub tablica indeksów (wielokrotny wybór)
 *    exp: krótkie wyjaśnienie (opcjonalne)
 * ------------------------------------------------------*/
const examA = [
  // r1 – Podstawy testowania
  {id:1, chapter:"r1", q:"Która z poniższych odpowiedzi opisuje poprawny cel testów?", opt:["Udowodnienie, że w systemie nie ma nieusuniętych defektów.","Udowodnienie, że po wdrożeniu nie będzie awarii.","Obniżenie ryzyka i wzrost zaufania do jakości.","Sprawdzenie, czy nie pozostały nieprzetestowane kombinacje wejść."], a:2, exp:"Testowanie redukuje ryzyko i dostarcza informacji – nie dowodzi braku defektów."},
  {id:2, chapter:"r1", q:"Które stwierdzenie przyczynia się do sukcesu projektu?", opt:["Włączenie testerów w SDLC pomaga wykrywać defekty.","Nie przeszkadzamy programistom podczas kodowania.","Współpraca z użytkownikami podnosi raporty tylko na integracji/systemie.","Certyfikat gwarantuje lepsze testy."], a:0, exp:"Wczesne i szerokie włączenie testów zwiększa jakość i szybkość feedbacku."},
  {id:3, chapter:"r1", q:"Brak zmian w testach regresji od kilku iteracji… Jaka zasada?", opt:["Testy ulegają zużyciu.","Złudzenie braku defektów.","Defekty się kumulują.","Gruntowne testowanie jest niemożliwe."], a:0, exp:"Nieaktualizowane testy tracą skuteczność."},
  {id:7, chapter:"r1", q:"Najbardziej istotne umiejętności testera?", opt:["Wizja produktu i planowanie zespołu.","Wiedza domenowa, praca zespołowa, krytyczne myślenie.","Wiedza domenowa, wizja, krytyczne myślenie.","Praca zespołowa i planowanie pracy zespołu."], a:1},

  // r2 – Testowanie w cyklu wytwarzania (modele, Agile, ATDD, regresja, poziomy)
  {id:8, chapter:"r2", q:"Podejście 'cały zespół' a przedstawiciele biznesu", opt:["Biznes decyduje o automatyzacji.","Testerzy pomagają biznesowi w strategii testów.","Biznes nie jest objęty podejściem whole‑team.","Testerzy pomagają biznesowi tworzyć testy akceptacyjne."], a:3},
  {id:9, chapter:"r2", q:"Przypisanie czynności testowych do SDLC obowiązuje…", opt:["Tylko w sekwencyjnych.","Tylko w iteracyjnych.","Tylko w iteracyjnych i przyrostowych.","We wszystkich: sekwencyjnych, przyrostowych i iteracyjnych."], a:3},
  {id:10, chapter:"r2", q:"ATDD – najlepszy opis", opt:["Kryteria akceptacji zwykle Given/When/Then.","Testy ATDD tworzy się na etapie modułowym i są ukierunkowane na kod.","Testy z kryteriów akceptacji prowadzą implementację.","Testy z pożądanego zachowania, łatwe do zrozumienia."], a:2},
  {id:11, chapter:"r2", q:"Które NIE jest przykładem shift‑left?", opt:["Przegląd wymagań przed akceptacją.","Pisanie testu modułowego przed kodem.","Test wydajności modułu na etapie testów modułowych.","Pisanie skryptu testowego przed ustanowieniem zarządzania konfiguracją."], a:3},
  {id:13, chapter:"r2", q:"Dopasuj typy awarii do poziomów testów", opt:["1D, 2B, 3A, 4C","1D, 2B, 3C, 4A","1B, 2A, 3D, 4C","1C, 2B, 3A, 4D"], a:0},
  {id:14, chapter:"r2", q:"Które testy są regresją w przebiegach?", opt:["4, 7, 8 i 9","5 i 7","4, 6, 8 i 9","5 i 6"], a:0},
  {id:16, chapter:"r2", q:"Korzyść z wczesnych i częstych informacji zwrotnych?", opt:["Usprawnienie procesu na przyszłość.","Wymuszenie priorytetów przez ryzyka.","Jedyny sposób mierzenia jakości zmian.","Unikanie nieporozumień wymagań."], a:3},
  {id:29, chapter:"r2", q:"ATDD dla historyjki redaktora – najlepszy przykład", opt:["Sprawdzenie zapisu dokumentu po redakcji przez redaktora.","Właściciel treści loguje się i aktualizuje treść.","Redaktor ustawia termin publikacji.","Redaktor zleca innemu redaktorowi aktualizację."], a:0},
  {id:30, chapter:"r2", q:"Wkład testerów w planowanie iteracji/wydań", opt:["Ustalają priorytety historyjek.","Skupiają się tylko na funkcjach.","Identyfikują i oceniają ryzyka dla historyjek.","Gwarantują jakość, projektując testy na starcie."], a:2},
  {id:34, chapter:"r2", q:"Kwadranty zwinne – przypisanie", opt:["1C, 2A, 3B, 4D","1D, 2A, 3C, 4B","1C, 2B, 3D, 4A","1D, 2B, 3C, 4A"], a:0},
  {id:36, chapter:"r2", q:"Artefakt pokazujący wykonaną i pozostałą pracę w iteracji", opt:["Kryteria akceptacji","Raport o defekcie","Raport sumaryczny","Wykres spalania"], a:3},

  // r3 – Testowanie statyczne (przeglądy)
  {id:15, chapter:"r3", q:"Korzyści testowania statycznego — które NIE?", opt:["Niższe koszty zarządzania defektami dzięki wykrywaniu późno.","Tańsze usuwanie defektów niż przy dynamicznym.","Wykrywanie defektów niewykrywalnych wyłącznie dynamicznie.","Wykrywanie luk i niespójności w wymaganiach."], a:0},
  {id:17, chapter:"r3", q:"Atrybuty przeglądów – który typ najpewniej?", opt:["Nieformalny","Przejrzenie","Przegląd techniczny","Inspekcja"], a:1},
  {id:18, chapter:"r3", q:"Co NIE wspiera sukcesu przeglądu?", opt:["Odpowiedni czas na przegląd.","Dzielenie dużych produktów na mniejsze.","Unikanie oznak znudzenia/irytacji/wrogości.","Obiektywne traktowanie wykrytych awarii."], a:2},

  // r4 – Analiza i projektowanie testów (techniki)
  {id:4, chapter:"r4", q:"Która czynność to analiza testów (płatności)?", opt:["Oszacowanie czasu 8 osobo‑dni.","Decyzja, by przetestować podział płatności.","Zastosowanie BVA do minimalnej kwoty.","Analiza rozbieżności i zgłoszenie defektu po teście karty."], a:1},
  {id:19, chapter:"r4", q:"Cechy technik opartych na doświadczeniu", opt:["Tworzone na podstawie szczegółów projektowych.","Pokrycie mierzone elementami testowanymi w interfejsach kodu.","Silnie bazują na wiedzy testera o systemie i domenie.","Identyfikują odchylenia od wymagań przypadkami."], a:2},
  {id:20, chapter:"r4", q:"Formularz mieszkań — ECP: minimalna liczba przypadków dla 100% klas?", opt:["3","4","5","6"], a:1},
  {id:21, chapter:"r4", q:"Oceny 0–100, BVA 2‑punktowa — jakie pokrycie zbioru PT1–PT6?", opt:["50%","60%","33,3%","100%"], a:1},
  {id:22, chapter:"r4", q:"Wypożyczalnia rowerów — która reguła niemożliwa?", opt:["R4","R2","R6","R8"], a:3},
  {id:23, chapter:"r4", q:"Minimum przypadków dla pokrycia poprawnych przejść (diagram stanów)", opt:["4","2","7","3"], a:3},
  {id:24, chapter:"r4", q:"100% pokrycia instrukcji oznacza…", opt:["Każda instrukcja zawierająca defekt została wykonana.","Dowolny większy zestaw też osiągnie 100% instrukcji.","Każda ścieżka musiała być wykonana.","Każda instrukcja została wykonana co najmniej raz."], a:3},
  {id:25, chapter:"r4", q:"Które stwierdzenie o białej skrzynce NIE jest prawdziwe?", opt:["Uwzględnia całą implementację.","Metryki pokrycia wskazują dodatkowe testy.","Można stosować w testowaniu statycznym.","Pozwala rozpoznać luki w implementacji wymagań."], a:2},
  {id:26, chapter:"r4", q:"Koncepcja zgadywania błędów — najlepszy opis", opt:["Wiedza o typowych defektach i błędach programistów.","Własne doświadczenie programistyczne.","Wyobrażenie użytkownika i jego pomyłek.","Szybka próba wytwarzania oprogramowania, by odtworzyć błędy."], a:0},
  {id:27, chapter:"r4", q:"Brak pełnych wymagań, potrzeba wstępnych wyników — jaka technika?", opt:["Lista kontrolna","Zgadywanie błędów","Eksploracyjne","Testowanie gałęzi"], a:2},
  {id:28, chapter:"r4", q:"Jak udokumentować kryteria akceptacji?", opt:["Retrospektywa potrzeb interesariuszy.","Warunek w Given/When/Then.","Słowne przekazanie informacji.","Ryzyka w planie testów dla danej historyjki."], a:1},

  // r5 – Zarządzanie testami (kryteria, estymacje, priorytety, ryzyko, CM, defekty)
  {id:5, chapter:"r5", q:"Czynniki istotnie wpływające na podejście do testów?", opt:["SDLC i liczba defektów z poprzednich projektów.","SDLC, ryzyka produktowe, wymogi formalnych testów białoskrzynkowych.","Liczba defektów wcześniej, wymogi białoskrzynkowe, konfiguracja środowiska.","Ryzyka produktowe i konfiguracja środowiska."], a:1},
  {id:6, chapter:"r5", q:"Wskaż DWA zadania głównie testerskie", opt:["Konfigurowanie środowiska testowego.","Prowadzenie backlogu produktu.","Projektowanie rozwiązań dla nowych wymagań.","Tworzenie planu testów.","Analizowanie podstawy testów."], a:[0,4]},
  {id:12, chapter:"r5", q:"Argument za retrospektywami po każdym cyklu release", opt:["Popularne – klienci zadowoleni.","Oszczędności, bo brak natychmiastowej informacji zwrotnej.","Analiza słabości → lista działań do ciągłego doskonalenia.","Realizują 5 wartości (np. odwaga, szacunek)."], a:2},
  {id:31, chapter:"r5", q:"Które DWIE stanowią kryteria wyjścia dla testowania systemu?", opt:["Gotowość środowiska","Możliwość zalogowania przez testera","Osiągnięcie szacowanej gęstości defektów","Przekształcenie wymagań do G/W/T","Zautomatyzowanie testów regresji"], a:[2,4]},
  {id:32, chapter:"r5", q:"Estymacja trójpunktowa: a=2, m=11, b=14 — wynik?", opt:["9","14","11","10"], a:3},
  {id:33, chapter:"r5", q:"Zależności i priorytety — który przypadek jako trzeci?", opt:["PT 003","PT 005","PT 002","PT 001"], a:0},
  {id:35, chapter:"r5", q:"Ryzyko: długi czas odpowiedzi raportu; reakcje: testy wydajności + alfa/beta — to…", opt:["Akceptacja","Plan awaryjny","Łagodzenie","Przeniesienie"], a:2},
  {id:37, chapter:"r5", q:"Nowa wersja skryptu testu — jaki proces to rejestruje?", opt:["Śledzenie powiązań","Testowanie pielęgnacyjne","Zarządzanie konfiguracją","Inżynieria wymagań"], a:2},
  {id:38, chapter:"r5", q:"Raport o defekcie – czego brakuje?", opt:["Oczekiwany i rzeczywisty rezultat.","Odwołania i status defektu.","Środowisko testowe i element testowy.","Priorytet i krytyczność."], a:2},
  {id:39, chapter:"r5", q:"Narzędzie do przygotowania danych testowych – w której czynności?", opt:["Monitorowanie i nadzór","Analiza i projektowanie","Implementacja i wykonywanie","Ukończenie testów"], a:2},

  // r6 – Narzędzia testowe
  {id:40, chapter:"r6", q:"Ryzyko związane z automatyzacją testów?", opt:["Automatyzacja wprowadzi nieznane regresje na produkcji.","Nakłady na utrzymanie testaliów mogą być niewystarczające.","Narzędzia i testalia mogą nie cieszyć się zaufaniem.","Automatyzacja skraca czas na testy manualne."], a:2}
];

// Pytania dodatkowe A1–A26 (przypisane tematycznie do rozdziałów)
examA.push(
  // r1 — Podstawy testowania
  {id:"A1", chapter:"r1", q:"Twoim zadaniem jest przeanalizowanie i usunięcie przyczyn awarii w nowym systemie. Którą czynność wykonujesz?", opt:["Debugowanie","Testowanie oprogramowania","Pozyskiwanie wymagań","Zarządzanie defektami"], a:0, exp:"Debugowanie polega na analizie przyczyny awarii i wprowadzeniu poprawki, po czym wykonuje się test potwierdzający (i regresję)."},
  {id:"A2", chapter:"r1", q:"Dział testowania bywa nazywany działem zapewnienia jakości. Czy to poprawne?", opt:["Tak – to ten sam proces","Tak – można używać zamiennie","Nie – testowanie to szerszy proces niż zapewnienie jakości","Nie – QA dotyczy procesów jakości, testowanie wykazuje zdatność i defekty"], a:3, exp:"QA skupia się na procesach jakości (zapewnienie), a testowanie ocenia produkt i ujawnia defekty – to nie są synonimy."},
  {id:"A3", chapter:"r1", q:"Nieprawidłowo zakodowana logika górnej wartości brzegowej to…", opt:["Podstawowa przyczyna","Awaria","Pomyłka","Defekt"], a:3, exp:"Błędny kod to defekt; awaria to widoczny objaw; pomyłka to błąd ludzki prowadzący do defektu; przyczyna jest źródłem defektu."},
  {id:"A5", chapter:"r1", q:"Który przykład NAJLEPIEJ pokazuje, jak śledzenie powiązań pomaga w testowaniu?", opt:["Analiza wpływu zmiany informuje o ukończeniu testów","Powiązania TC↔wyniki dają poziom ryzyka rezydualnego","Analiza wpływu zmiany pomaga dobrać testy regresji","Powiązania podstawa/element/TC ułatwiają dobór danych do pokrycia"], a:2, exp:"Traceability umożliwia wybór właściwych testów regresji po zmianach poprzez analizę powiązań."},
  {id:"A6", chapter:"r1", q:"Korzyść z niezależności testowania?", opt:["Można przenieść odpowiedzialność za jakość na zespół testowy","Zespół zewnętrzny nie ulega presji terminów","Niezależni testerzy pracują bez komunikacji z dev i tylko raportują defekty","Niezależni testerzy mogą zakwestionować założenia i interpretacje programisty"], a:3, exp:"Niezależna perspektywa pozwala kwestionować założenia autora i wykrywać niejednoznaczności/defekty wcześniej."},

  // r2 — Testowanie w cyklu wytwarzania
  {id:"A7", chapter:"r2", q:"W modelu V które aktywności MOŻNA wykonać wcześnie? (DWIE)", opt:["Testowanie dynamiczne","Testowanie statyczne","Planowanie testów","Wykonywanie testów akceptacyjnych","Testowanie pielęgnowalności"], a:[1,2], exp:"W V‑modelu wcześnie realizuje się planowanie i testy statyczne; wykonanie testów dynamicznych następuje później."},
  {id:"A8", chapter:"r2", q:"Które stwierdzenia opisują zalety DevOps?", opt:["Przyspieszenie wprowadzania produktów","Więcej powtarzalnych testów manualnych","Stała dostępność wykonywalnego oprogramowania","Mniej testów regresji po refaktoryzacji","Niskie koszty frameworków testów automatycznych dzięki automatyzacji całego procesu"], a:2, exp:"Główne korzyści: szybsze dostarczanie (i) oraz ciągła gotowość (iii); odpowiedź jednokrotna: i oraz iii → c."},
  {id:"A9", chapter:"r2", q:"Wymaganie: czas przetworzenia <10 s w 95% przypadków. Jaki typ testów?", opt:["Funkcjonalne","Niefunkcjonalne (wydajność)","Funkcjonalne (UI)","Strukturalne"], a:1, exp:"Mierzymy czas i SLA – to testy niefunkcjonalne (wydajnościowe)."},
  {id:"A10", chapter:"r2", q:"Test migracji danych przy wycofaniu systemu – w ramach jakiego typu testów?", opt:["Testowanie pielęgnacyjne","Testowanie regresji","Testowanie modułowe","Testowanie integracyjne"], a:0, exp:"Migracja przy wycofaniu/system replacement to typowe zadanie w testowaniu pielęgnacyjnym (maintenance)."},
  {id:"A18", chapter:"r2", q:"Wspólne pisanie historyjek użytkownika – najlepszy opis", opt:["PO akceptuje historie stworzone przez dev+QA","Historie tworzą wspólnie biznes, programiści i testerzy","Historie tworzy biznes, a dev/test je weryfikują","Historie powinny spełniać INVEST"], a:1, exp:"W podejściu zinnym historyjki powstają kolaboracyjnie: biznes + dev + test (three amigos)."},

  // r3 — Testowanie statyczne
  {id:"A11", chapter:"r3", q:"Które produkty pracy można objąć przeglądem?", opt:["Wymagania biznesowe","Harmonogram","Budżet testów","Kod wykonywalny innych firm","Historyjki i ich kryteria akceptacji"], a:2, exp:"Przeglądy obejmują m.in. wymagania, harmonogram, budżet testów oraz historyjki z kryteriami (i, ii, iii, v) → opcja C."},
  {id:"A12", chapter:"r3", q:"Które stwierdzenia o testowaniu statycznym są prawdziwe?", opt:["Łatwiej identyfikuje nieprawidłowe zewnętrzne zachowania","Łatwiej wykrywa odstępstwa od standardu kodowania","Umożliwia wykrycie awarii podczas uruchamiania","Celem jest jak najwcześniejsze wykrycie defektów","Łatwiej znaleźć i skorygować braki pokrycia krytycznych wymagań bezpieczeństwa"], a:3, exp:"Dla statycznego prawdą są ii i iv oraz v → odpowiedź D."},
  {id:"A13", chapter:"r3", q:"Które stwierdzenie o przeglądach formalnych jest PRAWDZIWE?", opt:["Niektóre przeglądy nie wymagają więcej niż jednej roli","Proces przeglądu składa się z kilku czynności","Dokument nie jest przekazywany przed spotkaniem","Defekty z przeglądu się nie zgłasza"], a:1, exp:"Formalny proces przeglądu ma zdefiniowane kroki (planowanie, przygotowanie, spotkanie, rework, follow‑up)."},
  {id:"A14", chapter:"r3", q:"Jakie zadanie może wykonywać kierownictwo podczas przeglądu formalnego?", opt:["Przyjęcie ogólnej odpowiedzialności za przegląd","Decydowanie, co ma być przedmiotem przeglądu","Moderowanie spotkania i mediacja","Protokołowanie"], a:1, exp:"To kierownictwo decyduje o zakresie/przedmiocie przeglądu; moderacja i protokołowanie są innymi rolami."},

  // r4 — Analiza i projektowanie testów
  {id:"A4", chapter:"r4", q:"Karta opisu testu (obiekt, dane, wykrywane defekty). W której czynności powstała?", opt:["Planowanie testów","Monitorowanie i nadzór","Analiza testów","Projektowanie testów"], a:3, exp:"Karta/procedura testu powstaje podczas projektowania testów – po analizie warunków."},
  {id:"A15", chapter:"r4", q:"Sterowanie temperaturą: BVA 3‑punktowa dla T=12. Minimalny zbiór wejść?", opt:["11, 12, 13","10, 12, 14","10, 11, 12, 13, 14","10, 11, 13, 14"], a:0, exp:"BVA 3‑punktowa testuje wartość brzegową i sąsiadujące: 11, 12, 13."},
  {id:"A16", chapter:"r4", q:"Które stwierdzenie o testowaniu gałęzi jest poprawne?", opt:["Przy gałęziach bezwarunkowych 100% gałęzi bez testów","Sprawdzenie wszystkich gałęzi bezwarunkowych daje 100% pokrycia","100% instrukcji ⇒ 100% gałęzi","100% gałęzi ⇒ sprawdzono wszystkie wyniki decyzji w każdej instrukcji decyzyjnej"], a:3, exp:"Pokrycie gałęzi 100% oznacza przejście wszystkich wyników decyzji w każdej instrukcji decyzyjnej."},
  {id:"A17", chapter:"r4", q:"Ocena ekranów wg ogólnej listy dobrych praktyk UI – to…", opt:["Testowanie czarnoskrzynkowe","Testowanie eksploracyjne","Testowanie w oparciu o listę kontrolną","Zgadywanie błędów"], a:2, exp:"Lista kontrolna (checklist‑based) to technika oparta na doświadczeniu, z gotowym zbiorem heurystyk."},

  // r5 — Zarządzanie testami
  {id:"A19", chapter:"r5", q:"W której części planu testów: wymagane 100% pokrycia gałęzi dla krytycznych modułów?", opt:["Wymiana informacji","Rejestr ryzyk","Kontekst testowania","Podejście do testowania"], a:3, exp:"Wybór kryterium pokrycia i poziomów testów to element podejścia do testowania."},
  {id:"A20", chapter:"r5", q:"Poker planistyczny: po 3. rundzie najwięcej głosów ma 13. Co dalej?", opt:["PO podejmuje decyzję","Przyjąć 13 jako ostateczne oszacowanie","Konsensus osiągnięty","Usunąć funkcjonalność z wydania"], a:1, exp:"Reguła zespołu: jeśli różnice są małe, przyjmij wartość z największą liczbą głosów – 13."},
  {id:"A21", chapter:"r5", q:"Piramida testów – które stwierdzenie jest prawdziwe?", opt:["Więcej testów na niższych poziomach","Każdy test niskopoziomowy sprawdza większą część funkcjonalności","Opisuje rozkład typów testów w SDLC","Nie wpływa na budowę testów automatycznych"], a:0, exp:"Piramida promuje większy wolumen testów na niższych poziomach (tańsze, szybsze, stabilniejsze)."},
  {id:"A22", chapter:"r5", q:"Wpływ ryzyka jest bardzo duży. Co z prawdopodobieństwem?", opt:["Też bardzo duże","Bardzo małe","Nie można nic powiedzieć – są niezależne","Nieistotne przy dużym wpływie"], a:2, exp:"Wpływ i prawdopodobieństwo są osobnymi wymiarami oceny ryzyka – wysokie jedno nie determinuje drugiego."},
  {id:"A23", chapter:"r5", q:"Które to ryzyka projektowe?", opt:["i oraz iv","iv oraz v","i oraz iii","ii oraz v"], a:0, exp:"Ryzyka projektowe dotyczą zarządzania projektem (zasoby, harmonogram, oczekiwania) – tutaj i oraz iv."},
  {id:"A24", chapter:"r5", q:"Jak analiza ryzyka produktowego wpływa na staranność i zakres?", opt:["Codzienny monitoring ryzyk do decyzji o release","Zidentyfikowano ryzyko braku obsługi OSS DB → integracja","Ilościowa ocena łącznego ryzyka rezydualnego przed testami","Wysokie ryzyko wydajności → szczegółowe testy wydajności wcześnie"], a:3, exp:"Wysokie ryzyko wydajności uzasadnia wcześniejsze i dokładniejsze testy wydajnościowe."},
  {id:"A25", chapter:"r5", q:"Wskaż DWIE metryki poziomu jakości przedmiotu testów", opt:["Liczba defektów wykrytych w testach systemowych","Nakład projektowania/ liczba TC","Liczba wykonanych procedur testowych","Gęstość defektów (defekty/rozmiar)","Czas usunięcia defektu"], a:[0,3], exp:"Typowe metryki jakości produktu: liczba defektów (np. z systemu) oraz gęstość defektów."},
  {id:"A26", chapter:"r5", q:"Która informacja w raporcie postępu jest NAJMNIEJ przydatna dla biznesu?", opt:["Przeszkody w testowaniu","Uzyskane pokrycie gałęzi","Postęp testów","Nowe ryzyka w cyklu testowym"], a:1, exp:"Pokrycie gałęzi to techniczna metryka niskopoziomowa; biznes bardziej interesuje postęp, ryzyka i przeszkody."}
);

/** -------------------------------------------------------
 *  PROSTA „PLATFORMA”
 * ------------------------------------------------------*/
const $$ = (sel, root=document) => root.querySelector(sel);
const $all = (sel, root=document) => Array.from(root.querySelectorAll(sel));

const state = {
  current: 0,
  flash: {side:"q", i:0},
  quizAnswers: {},
  results: JSON.parse(localStorage.getItem("istqb_results")||"{}")
};

function save(){ localStorage.setItem("istqb_results", JSON.stringify(state.results)); renderProgress(); }

function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }

function renderTOC(){
  const toc = syllabus.map((ch, idx)=>`<h3>${idx<6?"Rozdział":""}</h3>
    <button data-idx="${idx}" class="${state.current===idx?"active":""}">${ch.title}</button>`).join("");
  $$("#toc").innerHTML = toc + `<h3>Egzamin</h3><button data-exam="1">Egzamin końcowy</button>`;
  $all("#toc button").forEach(b=>{
    if(b.dataset.idx!==undefined){ b.onclick=()=>{state.current=+b.dataset.idx; renderChapter();}; }
    if(b.dataset.exam){ b.onclick=()=>renderFinalExam(); }
  });
}

function renderChapter(){
  const ch = syllabus[state.current];
  const rng = chapterToPdf[ch.id];
  if(rng){ renderPdfPages(rng.from, rng.to); }
  else { $$("#reading").innerHTML = `<div class="tag">${ch.title}</div>${ch.read}`; }
  $$("#after").innerHTML = `<div class="muted">Wybierz: <b>Fiszki</b> lub <b>Mini‑test</b>. Po zaliczeniu możesz przejść do kolejnego rozdziału.</div>`;
  renderTOC();
}

function renderProgress(){
  const res = state.results; let passed = 0, total = 0;
  syllabus.forEach(ch=>{ if(!ch.quiz) return; const key = ch.id+":quiz"; if(res[key]) passed += res[key].score; if(res[key]) total += res[key].total; });
  const hint = `Zebrane punkty: <b>${passed}</b> / ${total||"—"}`;
  $$("#progressHint").innerHTML = hint;
}

function startFlashcards(){
  const ch = syllabus[state.current];
  const list = shuffle(ch.flashcards || []);
  state.flash = {side:"q", i:0, list};
  const host = $$("#after");
  host.innerHTML = `
    <div class="flash">
      <div class="tag">Fiszka ${state.flash.i+1}/${list.length}</div>
      <div class="flip" id="flip">${list[0]?.q||"Brak fiszek"}</div>
      <div class="row">
        <button class="btn" id="know">Znam</button>
        <button class="btn secondary" id="dont">Nie wiem</button>
        <button class="btn flat" id="nextF">Następna</button>
      </div>
      <div class="hint">Kliknij kartę, aby obrócić.</div>
    </div>`;
  const flip = $$("#flip");
  flip.onclick = ()=>{
    state.flash.side = state.flash.side==="q"?"a":"q";
    flip.classList.toggle("flipped");
    flip.innerHTML = state.flash.side==="q"?list[state.flash.i].q:list[state.flash.i].a;
  };
  $$("#nextF").onclick = ()=>{ state.flash.i = (state.flash.i+1)%list.length; state.flash.side="q"; flip.classList.remove("flipped"); flip.innerHTML=list[state.flash.i].q; $$(".tag").innerHTML=`Fiszka ${state.flash.i+1}/${list.length}`; };
  $$("#know").onclick = ()=>alert("Super! Przejdź do mini‑testu gdy będziesz gotowy.");
  $$("#dont").onclick = ()=>alert("Zapisz trudne fiszki – możesz je dodać/rozszerzyć w danych.");
}

function startQuiz(mode="chapter"){
  const ch = syllabus[state.current];
  const questions = shuffle([...(questionsForChapter(ch.id))]);
  renderQuiz(questions, ch.id+":quiz", ch.title, mode);
}

function flattenAllQuestions(){
  // Z egzaminu A – wszystkie pytania w kolejności przypisania
  return examA.map(x=>({
    q:x.q,
    opt:x.opt,
    a:x.a,
    exp:x.exp,
    why:x.why,
    chapter: x.chapter
  }));
}

function renderQuiz(questions, key, label, mode){
  const host = $$("#after");
  host.innerHTML = `<div class="quiz">
    <div class="tag">${mode==="exam"?"Egzamin":`Mini‑test: ${label}`}</div>
    ${questions.map((q,i)=>`
      <div class="q">
        <div><b>${i+1}. ${q.q}</b></div>
        ${q.opt.map((o,oi)=>{
          const multi = Array.isArray(q.a);
          const input = multi? `<input type="checkbox" name="q${i}" value="${oi}">` : `<input type="radio" name="q${i}" value="${oi}">`;
          return `<label class="opt">${input} ${o}</label>`;
        }).join("")}
        <div class="explain" data-exp style="display:none">${formatWhy(q)}</div>
      </div>`).join("")}
    <div class="controls">
      <button class="btn" id="check">Sprawdź</button>
      <button class="btn flat" id="resetQuiz">Wyczyść odpowiedzi</button>
    </div>
    <div id="quizResult"></div>
  </div>`;

  $$("#check").onclick = ()=>{
    let score=0; questions.forEach((q,i)=>{
      const inputs = $all(`input[name=q${i}]`);
      const checked = inputs.filter(n=>n.checked).map(n=>+n.value);
      const labels = $all(`.q:nth-child(${i+2}) .opt`, host); // +1 for tag div
      labels.forEach((lb,oi)=>{
        lb.classList.remove("correct","wrong");
        const correctSet = new Set(Array.isArray(q.a)? q.a : [q.a]);
        if(correctSet.has(oi)) lb.classList.add("correct");
        if(checked.includes(oi) && !correctSet.has(oi)) lb.classList.add("wrong");
      });
      const correctSet = new Set(Array.isArray(q.a)? q.a : [q.a]);
      const chosenSet = new Set(checked);
      let ok = chosenSet.size===correctSet.size;
      if(ok){ for(const c of chosenSet){ if(!correctSet.has(c)){ ok=false; break; } } }
      if(ok) score++;
      const exp = $all(`.q:nth-child(${i+2}) [data-exp]`, host)[0]; if(exp) exp.style.display="block";
    });
    const percent = Math.round(100*score/questions.length);
    $$("#quizResult").innerHTML = `<div class="result"><b>Wynik:</b> ${score}/${questions.length} (${percent}%). ${mode==="exam"?`Próg zdania: 65%. ${percent>=65?"✅ ZALICZONO":"❌ Nie zaliczono"}`:""}</div>`;
    state.results[key] = {score, total:questions.length, ts:Date.now()}; save();
  };

  $$("#resetQuiz").onclick = ()=>{ $all("input[type=radio]", host).forEach(i=>i.checked=false); $$("#quizResult").innerHTML=""; $all(".opt", host).forEach(o=>o.classList.remove("correct","wrong")); };
}

// Zwróć pytania dla danego rozdziału na podstawie przypisania z examA
function questionsForChapter(chId){
  return examA.filter(x=>x.chapter===chId).map(x=>({q:x.q, opt:x.opt, a:x.a, exp:x.exp, why:x.why}));
}

function renderFinalExam(){
  state.current = 0; renderTOC();
  const all = shuffle(flattenAllQuestions());
  $$("#reading").innerHTML = `<div class="tag">Egzamin końcowy</div>
    <h2>Egzamin końcowy</h2><p>Zawiera wszystkie pytania (40 + A1–A26 = 76). Próg zaliczenia: <b>65%</b>.</p>`;
  renderQuiz(all, "final:exam", "Egzamin", "exam");
}

// Wire UI
$$("#showFlash").onclick = startFlashcards;
$$("#showQuiz").onclick = ()=>startQuiz();
$$("#nextChapter").onclick = ()=>{ state.current = Math.min(state.current+1, syllabus.length-1); renderChapter(); };
$$("#fullExamBtn").onclick = renderFinalExam;
$$("#resetBtn").onclick = ()=>{ if(confirm("Wyczyścić zapisane wyniki?")){ localStorage.removeItem("istqb_results"); state.results={}; renderProgress(); }}

// Init
renderTOC();
renderChapter();
renderProgress();
</script>
<!-- pdf.js (CDN) do renderowania pełnego sylabusa w rozdziałach -->
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.worker.min.js";</script>
</body>
</html>
